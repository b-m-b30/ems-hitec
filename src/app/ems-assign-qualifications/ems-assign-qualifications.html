<h2>Qualifikationszuweisung</h2>

<div class="assign-container">
  <!-- Teil 1: Mitarbeiter auswählen -->
  <div class="column">
    <h3>Mitarbeiter auswählen</h3>

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="status-message">Lade Daten...</div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="error-message" (click)="employeeStore.clearError(); qualificationsStore.clearError()" style="cursor: pointer;" title="Klicken zum Ausblenden">
        Fehler: {{ error() }}
      </div>
    }

    <!-- Empty State / Add Button -->
    @if (employees().length === 0 && !isLoading()) {
      <div class="empty-state">
        <p>Keine Mitarbeiter gefunden.</p>
        <button class="btn-primary" (click)="createTestEmployee()">Test-Mitarbeiter anlegen</button>
      </div>
    }

    <!-- Dropdown -->
    <div class="form-group">
      <label for="employeeSelect">Mitarbeiter:</label>
      <select id="employeeSelect" class="employee-select"
              [disabled]="employees().length === 0"
              [value]="employeeStore.selectedEmployee()?.id || ''"
              (change)="onEmployeeSelect($event)">
        <option value="" disabled selected>
            @if (error()) { Fehler beim Laden }
            @else if (isLoading()) { Lade... }
            @else if (employees().length === 0) { Keine Mitarbeiter verfügbar }
            @else { -- Bitte wählen -- }
        </option>
        @for (employee of employees(); track employee.id) {
          <option [value]="employee.id">
            {{ employee.lastName }}, {{ employee.firstName }}
          </option>
        }
      </select>
    </div>
  </div>

  <!-- Teil 2: Qualifikationen (Verfügbar) -->
  <div class="column">
    <h3>Verfügbare Qualifikationen</h3>
    @if (!employeeStore.selectedEmployee()) {
      <p class="placeholder-text">Bitte wählen Sie zuerst einen Mitarbeiter aus.</p>
    } @else {
      @if (availableQualifications().length === 0) {
        <p class="empty-list-text">Keine weiteren Qualifikationen verfügbar.</p>
      } @else {
        <ul class="qualification-list available-list">
          @for (qual of availableQualifications(); track qual.id) {
            <li (click)="assignQualification(qual)" title="Hinzufügen">
              {{ qual.skill }}
              <span class="action-icon">+</span>
            </li>
          }
        </ul>
      }
    }
  </div>

  <!-- Teil 3: Zugewiesen -->
  <div class="column">
    <h3>Zugewiesen</h3>
    @if (!employeeStore.selectedEmployee()) {
       <p class="placeholder-text">Bitte wählen Sie zuerst einen Mitarbeiter aus.</p>
    } @else {
      @if (assignedQualifications().length === 0) {
        <p class="empty-list-text">Keine Qualifikationen zugewiesen.</p>
      } @else {
        <ul class="qualification-list assigned-list">
          @for (qual of assignedQualifications(); track qual.id) {
            <li (click)="unassignQualification(qual)" title="Entfernen">
              {{ qual.skill }}
              <span class="action-icon">&times;</span>
            </li>
          }
        </ul>
      }
    }
  </div>
</div>
